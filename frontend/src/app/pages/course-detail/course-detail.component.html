<div class="course-detail-container">
  <div class="course-header">
    <div class="header-top">
      <button class="back-btn" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"/>
          <polyline points="12 19 5 12 12 5"/>
        </svg>
        Back to Courses
      </button>
      <button
        class="favorite-btn"
        [class.favorited]="isFavorite()"
        (click)="toggleFavorite()"
        *ngIf="course"
        [attr.aria-label]="isFavorite() ? 'Remove from favorites' : 'Add to favorites'"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" [attr.fill]="isFavorite() ? 'currentColor' : 'none'" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
      </button>
    </div>
    <h1 *ngIf="course">{{ course.course_name }}</h1>
    <p *ngIf="course" class="course-description">{{ course.course_description }}</p>

    <!-- Overall Progress -->
    <div class="overall-progress" *ngIf="course && getTotalQuestions() > 0">
      <div class="progress-header">
        <span class="progress-label">Overall Progress</span>
        <span class="progress-text">{{ getCompletedCount() }}/{{ getTotalQuestions() }} completed ({{ getOverallProgress() }}%)</span>
      </div>
      <div class="progress-bar-container">
        <div class="progress-bar-fill" [style.width.%]="getOverallProgress()"></div>
      </div>
    </div>
  </div>
  
  <div class="sections-container" *ngIf="courseSections.length > 0">
    <div *ngFor="let section of courseSections" class="course-section">
      <div class="section-header">
        <div class="section-title-row" (click)="toggleSection(section.unitKey)">
          <h2>
            <span class="title-text" (click)="onUnitClick(section.unitKey); $event.stopPropagation()">{{ section.title }}</span>
            <span class="question-count" *ngIf="section.questions.length > 0">({{ section.questions.length }} questions)</span>
          </h2>
          <svg
            class="chevron"
            [class.expanded]="isSectionExpanded(section.unitKey)"
            width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </div>

        <p *ngIf="section.description" class="section-description">{{ section.description }}</p>

        <!-- Section Progress -->
        <div class="section-progress" *ngIf="section.questions.length > 0">
          <div class="progress-bar-mini">
            <div class="progress-fill-mini"
                 [style.width.%]="getSectionProgress(section)"
                 [class.completed]="getSectionProgress(section) === 100"></div>
          </div>
          <span class="section-progress-text">{{ getSectionCompletedCount(section) }}/{{ section.questions.length }} completed</span>
        </div>
      </div>
      
      <div class="questions-list" *ngIf="isSectionExpanded(section.unitKey) && section.questions.length > 0">
        <div
          *ngFor="let question of section.questions"
          class="question-item"
          [class.completed]="isQuestionCompleted(question.filename)"
          (click)="onQuestionClick(question)"
        >
          <div class="question-content">
            <div class="tags-container" *ngIf="question.tags && question.tags.length > 0">
              <span
                *ngFor="let tag of question.tags"
                class="difficulty-tag"
                [style.background-color]="tag.color + '20'"
                [style.color]="tag.color"
                [style.border]="'1px solid ' + tag.color + '40'"
              >
                {{ tag.text }}
              </span>
            </div>
            <h3>{{ question.title }}</h3>
          </div>
          <div class="question-actions">
            <button
              *ngFor="let urlItem of question.urls"
              class="url-btn"
              [style.background-color]="urlItem.color + '20'"
              [style.border]="'1px solid ' + urlItem.color + '40'"
              [style.color]="urlItem.color"
              (click)="onUrlClick($event, urlItem.url)"
              [title]="urlItem.tooltip"
            >
              {{ urlItem.visibleString || 'Link' }}
            </button>
            <svg *ngIf="isQuestionCompleted(question.filename)" class="completion-check" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </div>
        </div>
      </div>
      
      <div *ngIf="section.questions.length === 0" class="no-questions-in-section">
        <p>No questions in this section yet.</p>
      </div>
    </div>
  </div>
  
  <div *ngIf="courseSections.length === 0 && course" class="no-sections">
    <p>No sections found in this course.</p>
  </div>
</div>