<div class="quiz-home">
  <div class="quiz-home-container">
    <h1 class="quiz-title">Quizy</h1>
    <p class="quiz-subtitle">Real-time multiplayer quizzes</p>

    <div class="quiz-actions">
      <!-- Join Quiz Section (for all users) -->
      <div class="quiz-card join-card">
        <h2>Join a Quiz</h2>
        <p>Enter the room code to join a quiz</p>

        <div class="form-group">
          <input
            type="text"
            [(ngModel)]="roomCode"
            placeholder="Enter 4-digit room code"
            maxlength="4"
            class="room-code-input"
            [disabled]="isJoining"
            (keyup.enter)="joinQuiz()"
          />
        </div>

        <div class="error-message" *ngIf="joinError">
          {{ joinError }}
        </div>

        <button
          class="btn btn-primary"
          (click)="joinQuiz()"
          [disabled]="isJoining || !roomCode.trim()"
        >
          {{ isJoining ? 'Joining...' : 'Join Quiz' }}
        </button>
      </div>

      <!-- Create Quiz Section (admin only) -->
      <div class="quiz-card create-card" *ngIf="isAdmin">
        <h2>Create a Quiz</h2>
        <p>Start a new quiz session</p>

        <div class="form-group">
          <label for="template-select">Select Quiz Template</label>
          <select
            id="template-select"
            [(ngModel)]="selectedTemplateId"
            class="template-select"
            [disabled]="isCreating"
          >
            <option *ngFor="let template of templates" [value]="template.id">
              {{ template.name }}
            </option>
          </select>
        </div>

        <div class="error-message" *ngIf="createError">
          {{ createError }}
        </div>

        <button
          class="btn btn-primary"
          (click)="createQuiz()"
          [disabled]="isCreating || !selectedTemplateId"
        >
          {{ isCreating ? 'Creating...' : 'Create Quiz' }}
        </button>

        <!-- Templates List with Hide Buttons -->
        <div class="templates-list" *ngIf="templates.length > 0">
          <h3>Manage Templates</h3>
          <div class="template-item" *ngFor="let template of templates">
            <span class="template-name">{{ template.name }}</span>
            <button
              class="btn btn-hide"
              (click)="hideTemplate(template.id)"
              title="Hide this quiz template"
            >
              Hide
            </button>
          </div>
        </div>

        <!-- Hidden Templates Section -->
        <div class="hidden-templates-section" *ngIf="hiddenTemplates.length > 0">
          <button
            class="toggle-hidden-btn"
            (click)="toggleHiddenSection()"
          >
            {{ showHiddenSection ? '▼' : '▶' }} Hidden Templates ({{ hiddenTemplates.length }})
          </button>

          <div class="templates-list" *ngIf="showHiddenSection">
            <div class="template-item" *ngFor="let template of hiddenTemplates">
              <span class="template-name">{{ template.name }}</span>
              <button
                class="btn btn-show"
                (click)="showTemplate(template.id)"
                title="Restore this quiz template"
              >
                Restore
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Upload Quiz Section (admin only) -->
      <div class="quiz-card upload-card" *ngIf="isAdmin">
        <h2>Upload a Quiz</h2>
        <p>Upload a quiz from JSON file</p>

        <div class="form-group">
          <label>Quiz JSON</label>
          <textarea
            [(ngModel)]="jsonContent"
            placeholder="Paste quiz JSON or select a file..."
            class="json-textarea"
            [disabled]="isUploading"
          ></textarea>
        </div>

        <div class="button-group">
          <button
            class="btn btn-secondary"
            (click)="openFileInput()"
            [disabled]="isUploading"
          >
            Choose File
          </button>
          <button
            class="btn btn-secondary"
            (click)="downloadSamples()"
            [disabled]="isUploading"
          >
            Download Samples
          </button>
          <input
            #fileInput
            type="file"
            accept=".json"
            (change)="onFileSelected($event)"
            style="display: none"
          />
        </div>

        <div class="error-message" *ngIf="uploadError">
          {{ uploadError }}
        </div>

        <div class="success-message" *ngIf="uploadSuccess">
          {{ uploadSuccess }}
        </div>

        <button
          class="btn btn-primary"
          (click)="uploadQuiz()"
          [disabled]="isUploading || !jsonContent.trim()"
        >
          {{ isUploading ? 'Uploading...' : 'Upload Quiz' }}
        </button>
      </div>
    </div>

    <!-- Not signed in message -->
    <div class="auth-message" *ngIf="!(currentUser$ | async)">
      <p>
        Please
        <a routerLink="/auth/sign-in">sign in</a>
        to join or create quizzes
      </p>
    </div>
  </div>
</div>
