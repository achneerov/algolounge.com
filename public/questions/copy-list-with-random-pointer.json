{
  "filename": "copy-list-with-random-pointer",
  "title": "Copy List with Random Pointer",
  "keywords": [
    "copy",
    "linked",
    "list",
    "random",
    "pointer",
    "leetcode",
    "138",
    "given",
    "head",
    "deep",
    "clone",
    "hash",
    "map"
  ],
  "description": "<h2>Copy List with Random Pointer</h2><p>You are given the head of a linked list of length <code>n</code>. Unlike a singly linked list, each node contains an additional pointer <code>random</code>, which may point to any node in the list, or <code>null</code>.</p><p>Create a <strong>deep copy</strong> of the list.</p><p>The deep copy should consist of exactly <code>n</code> <strong>new</strong> nodes, each including:</p><ul><li>The original value <code>val</code> of the copied node</li><li>A <code>next</code> pointer to the new node corresponding to the <code>next</code> pointer of the original node</li><li>A <code>random</code> pointer to the new node corresponding to the <code>random</code> pointer of the original node</li></ul><p>Note: None of the pointers in the new list should point to nodes in the original list.</p><p><em>Return the head of the copied linked list.</em></p><h3>Visual Representation:</h3><p>In the examples, the linked list is represented as a list of <code>n</code> nodes. Each node is represented as a pair of <code>[val, random_index]</code> where <code>random_index</code> is the index of the node (0-indexed) that the <code>random</code> pointer points to, or <code>null</code> if it does not point to any node.</p><h4>Example 1 Detailed Breakdown:</h4><p><strong>Input:</strong> <code>[[7,null],[13,0],[11,4],[10,2],[1,0]]</code></p><div style=\"background-color: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef; margin: 10px 0;\"><p style=\"margin: 0 0 10px 0; font-weight: bold;\">ðŸ”— Linked List Structure:</p><table style=\"font-family: monospace; font-size: 12px; border-collapse: collapse;\"><tr><td>Index:</td><td style=\"padding: 0 10px;\">0</td><td style=\"padding: 0 10px;\">1</td><td style=\"padding: 0 10px;\">2</td><td style=\"padding: 0 10px;\">3</td><td style=\"padding: 0 10px;\">4</td></tr><tr><td>Value:</td><td style=\"padding: 0 10px; border: 1px solid #ccc; background: #fff; text-align: center;\">[7]</td><td style=\"padding: 0 10px;\">â†’</td><td style=\"padding: 0 10px; border: 1px solid #ccc; background: #fff; text-align: center;\">[13]</td><td style=\"padding: 0 10px;\">â†’</td><td style=\"padding: 0 10px; border: 1px solid #ccc; background: #fff; text-align: center;\">[11]</td><td style=\"padding: 0 10px;\">â†’</td><td style=\"padding: 0 10px; border: 1px solid #ccc; background: #fff; text-align: center;\">[10]</td><td style=\"padding: 0 10px;\">â†’</td><td style=\"padding: 0 10px; border: 1px solid #ccc; background: #fff; text-align: center;\">[1]</td><td style=\"padding: 0 10px;\">â†’</td><td>null</td></tr><tr><td>Random â†’:</td><td style=\"padding: 0 10px; color: #dc3545;\">null</td><td></td><td style=\"padding: 0 10px; color: #dc3545;\">0</td><td></td><td style=\"padding: 0 10px; color: #dc3545;\">4</td><td></td><td style=\"padding: 0 10px; color: #dc3545;\">2</td><td></td><td style=\"padding: 0 10px; color: #dc3545;\">0</td><td></td><td></td></tr></table><p style=\"margin: 10px 0 0 0; font-size: 14px;\"><strong>Random Pointer Details:</strong></p><ul style=\"margin: 5px 0; font-size: 13px;\"><li>Node 0 (val=7): random â†’ null</li><li>Node 1 (val=13): random â†’ Node 0 (val=7)</li><li>Node 2 (val=11): random â†’ Node 4 (val=1)</li><li>Node 3 (val=10): random â†’ Node 2 (val=11)</li><li>Node 4 (val=1): random â†’ Node 0 (val=7)</li></ul></div><h4>Example 2 Detailed Breakdown:</h4><p><strong>Input:</strong> <code>[[1,1],[2,1]]</code></p><div style=\"background-color: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef; margin: 10px 0;\"><p style=\"margin: 0 0 10px 0; font-weight: bold;\">ðŸ”— Linked List Structure:</p><table style=\"font-family: monospace; font-size: 12px; border-collapse: collapse;\"><tr><td>Index:</td><td style=\"padding: 0 10px;\">0</td><td style=\"padding: 0 10px;\">1</td></tr><tr><td>Value:</td><td style=\"padding: 0 10px; border: 1px solid #ccc; background: #fff; text-align: center;\">[1]</td><td style=\"padding: 0 10px;\">â†’</td><td style=\"padding: 0 10px; border: 1px solid #ccc; background: #fff; text-align: center;\">[2]</td><td style=\"padding: 0 10px;\">â†’</td><td>null</td></tr><tr><td>Random â†’:</td><td style=\"padding: 0 10px; color: #dc3545;\">1</td><td></td><td style=\"padding: 0 10px; color: #dc3545;\">1</td><td></td><td></td></tr></table><p style=\"margin: 10px 0 0 0; font-size: 14px;\"><strong>Random Pointer Details:</strong></p><ul style=\"margin: 5px 0; font-size: 13px;\"><li>Node 0 (val=1): random â†’ Node 1 (val=2)</li><li>Node 1 (val=2): random â†’ Node 1 (val=2) [self-reference]</li></ul></div><h4>Example 3 Detailed Breakdown:</h4><p><strong>Input:</strong> <code>[[3,null],[3,0],[3,null]]</code></p><div style=\"background-color: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef; margin: 10px 0;\"><p style=\"margin: 0 0 10px 0; font-weight: bold;\">ðŸ”— Linked List Structure:</p><table style=\"font-family: monospace; font-size: 12px; border-collapse: collapse;\"><tr><td>Index:</td><td style=\"padding: 0 10px;\">0</td><td style=\"padding: 0 10px;\">1</td><td style=\"padding: 0 10px;\">2</td></tr><tr><td>Value:</td><td style=\"padding: 0 10px; border: 1px solid #ccc; background: #fff; text-align: center;\">[3]</td><td style=\"padding: 0 10px;\">â†’</td><td style=\"padding: 0 10px; border: 1px solid #ccc; background: #fff; text-align: center;\">[3]</td><td style=\"padding: 0 10px;\">â†’</td><td style=\"padding: 0 10px; border: 1px solid #ccc; background: #fff; text-align: center;\">[3]</td><td style=\"padding: 0 10px;\">â†’</td><td>null</td></tr><tr><td>Random â†’:</td><td style=\"padding: 0 10px; color: #dc3545;\">null</td><td></td><td style=\"padding: 0 10px; color: #dc3545;\">0</td><td></td><td style=\"padding: 0 10px; color: #dc3545;\">null</td><td></td><td></td></tr></table><p style=\"margin: 10px 0 0 0; font-size: 14px;\"><strong>Random Pointer Details:</strong></p><ul style=\"margin: 5px 0; font-size: 13px;\"><li>Node 0 (val=3): random â†’ null</li><li>Node 1 (val=3): random â†’ Node 0 (val=3)</li><li>Node 2 (val=3): random â†’ null</li></ul></div><h3>Examples:</h3><ul><li>Input: head = [[7,null],[13,0],[11,4],[10,2],[1,0]]<br><br>Output: [[7,null],[13,0],[11,4],[10,2],[1,0]]</li><li>Input: head = [[1,1],[2,1]]<br><br>Output: [[1,1],[2,1]]</li><li>Input: head = [[3,null],[3,0],[3,null]]<br><br>Output: [[3,null],[3,0],[3,null]]</li></ul><h3>Constraints:</h3><ul><li><code>0 <= n <= 1000</code></li><li><code>-10^4 <= Node.val <= 10^4</code></li><li><code>random</code> is <code>null</code> or is pointing to some node in the linked list.</li></ul>",
  "entry_function": "copyRandomList",
  "template": "def copyRandomList(head):\n    ",
  "solution_text": "<h3>Copy List with Random Pointer</h3><p><strong>Algorithm:</strong></p><ol><li>First pass: Create new nodes and store original->new mapping in hash map</li><li>Second pass: Set next and random pointers using the mapping</li><li>Handle null pointers appropriately</li></ol><p><strong>Time Complexity:</strong> O(n) - two passes through the list</p><p><strong>Space Complexity:</strong> O(n) - hash map storage</p><p><strong>Key Insights:</strong></p><ul><li>Hash map enables O(1) node lookup</li><li>Two-pass approach separates node creation from pointer assignment</li><li>Deep copy requires all new nodes with no references to original</li><li>Handle edge cases: null head, single node, cycles</li></ul>",
  "solution_code": "def copyRandomList(head):\n    if not head:\n        return None\n    \n    # Hash map to store mapping from original to new nodes\n    node_map = {}\n    \n    # First pass: create new nodes\n    current = head\n    while current:\n        node_map[current] = ListNode(current.val)\n        current = current.next\n    \n    # Second pass: set next and random pointers\n    current = head\n    while current:\n        new_node = node_map[current]\n        \n        # Set next pointer\n        if current.next:\n            new_node.next = node_map[current.next]\n        \n        # Set random pointer\n        if current.random:\n            new_node.random = node_map[current.random]\n        \n        current = current.next\n    \n    return node_map[head]",

  "prepare": "class ListNode:\n    def __init__(self, val=0, next=None, random=None):\n        self.val = val\n        self.next = next\n        self.random = random\n    \n    def __repr__(self):\n        return f'ListNode({self.val})'\n\ndef prepare(test_case_input):\n    \"\"\"Convert array representation to ListNode structure with random pointers\"\"\"\n    nodes_data = test_case_input['head']\n    if not nodes_data:\n        return (None,)\n    \n    # Create all nodes first\n    nodes = []\n    for val, _ in nodes_data:\n        nodes.append(ListNode(val))\n    \n    # Set next pointers\n    for i in range(len(nodes) - 1):\n        nodes[i].next = nodes[i + 1]\n    \n    # Set random pointers\n    for i, (_, random_idx) in enumerate(nodes_data):\n        if random_idx is not None:\n            nodes[i].random = nodes[random_idx]\n    \n    return (nodes[0] if nodes else None,)",

  "verify": "def verify(actual_output, expected_output):\n    \"\"\"Verify the copied linked list structure\"\"\"\n    def list_to_array(head):\n        \"\"\"Convert linked list back to array format for comparison\"\"\"\n        if not head:\n            return []\n        \n        # First pass: collect all nodes and build index mapping\n        nodes = []\n        node_to_index = {}\n        current = head\n        index = 0\n        \n        while current:\n            nodes.append(current)\n            node_to_index[current] = index\n            current = current.next\n            index += 1\n        \n        # Second pass: build result array\n        result = []\n        for node in nodes:\n            random_idx = node_to_index[node.random] if node.random else None\n            result.append([node.val, random_idx])\n        \n        return result\n    \n    def array_to_string(arr):\n        if not arr:\n            return '[]'\n        return '[' + ', '.join(f'[{val}, {random_idx}]' for val, random_idx in arr) + ']'\n    \n    actual_array = list_to_array(actual_output)\n    passed = actual_array == expected_output\n    output_str = array_to_string(actual_array)\n    \n    return [passed, output_str]",

  "test_cases": [
    {
      "id": 1,
      "input": {
        "head": []
      },
      "output": []
    },
    {
      "id": 2,
      "input": {
        "head": [[7, null], [13, 0], [11, 4], [10, 2], [1, 0]]
      },
      "output": [[7, null], [13, 0], [11, 4], [10, 2], [1, 0]]
    },
    {
      "id": 3,
      "input": {
        "head": [[1, 1], [2, 1]]
      },
      "output": [[1, 1], [2, 1]]
    },
    {
      "id": 4,
      "input": {
        "head": [[3, null], [3, 0], [3, null]]
      },
      "output": [[3, null], [3, 0], [3, null]]
    },
    {
      "id": 5,
      "input": {
        "head": [[1, null]]
      },
      "output": [[1, null]]
    },
    {
      "id": 6,
      "input": {
        "head": [[1, 0], [2, 0]]
      },
      "output": [[1, 0], [2, 0]]
    },
    {
      "id": 7,
      "input": {
        "head": [[7, null], [13, 0], [11, 4], [10, 2], [1, 0]]
      },
      "output": [[7, null], [13, 0], [11, 4], [10, 2], [1, 0]]
    },
    {
      "id": 8,
      "input": {
        "head": [[1, 1], [2, 1], [3, 2]]
      },
      "output": [[1, 1], [2, 1], [3, 2]]
    },
    {
      "id": 9,
      "input": {
        "head": [[1, 0], [2, 1], [3, 0], [4, 2]]
      },
      "output": [[1, 0], [2, 1], [3, 0], [4, 2]]
    },
    {
      "id": 10,
      "input": {
        "head": [[10, 1], [20, 0], [30, null]]
      },
      "output": [[10, 1], [20, 0], [30, null]]
    }
  ]
}